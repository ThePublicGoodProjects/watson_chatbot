var Api=function(){var t,n;return{sendRequest:function(e,t){var n={};e&&(n.input={text:e});t&&(n.context=t);var s=new XMLHttpRequest;s.open("POST","/api/message",!0),s.setRequestHeader("Content-type","application/json"),s.onreadystatechange=function(){4===s.readyState&&200===s.status&&s.responseText&&Api.setResponsePayload(s.responseText)};var a=JSON.stringify(n);0!==Object.getOwnPropertyNames(n).length&&Api.setRequestPayload(a);s.send(a)},getRequestPayload:function(){return t},setRequestPayload:function(e){t=JSON.parse(e)},getResponsePayload:function(){return n},setResponsePayload:function(e){n=JSON.parse(e)}}}(),Common={buildDomElement:function e(t){var n=document.createElement(t.tagName);if(t.text?n.innerHTML=t.text:t.html&&n.insertAdjacentHTML("beforeend",t.html),t.classNames)for(var s=0;s<t.classNames.length;s++)n.classList.add(t.classNames[s]);if(t.attributes)for(var a=0;a<t.attributes.length;a++){var o=t.attributes[a];n.setAttribute(o.name,o.value)}if(t.children)for(var r=0;r<t.children.length;r++){var l=t.children[r];n.appendChild(e(l))}return n},fireEvent:function(e,t){var n;return document.createEventObject?(n=document.createEventObject(),e.fireEvent("on"+t,n)):((n=document.createEvent("HTMLEvents")).initEvent(t,!0,!0),!e.dispatchEvent(n))},listForEach:function(e,t){for(var n=0;n<e.length;n++)t.call(null,e[n])}},ConversationPanel=function(){var l={selectors:{chatBox:"#scrollingChat",fromUser:".from-user",fromWatson:".from-watson",latest:".latest"},authorTypes:{user:"user",watson:"watson"}};return{init:function(){(function(){var t=Api.setRequestPayload;Api.setRequestPayload=function(e){t.call(Api,e),s(JSON.parse(e),l.authorTypes.user)};var n=Api.setResponsePayload;Api.setResponsePayload=function(e){n.call(Api,e),s(JSON.parse(e),l.authorTypes.watson)}})(),Api.sendRequest("",{bot_type:"layla"}),function(){var o=document.getElementById("textInput"),r=document.getElementById("textInputDummy");if(null===r){r=Common.buildDomElement({tagName:"div",attributes:[{name:"id",value:"textInputDummy"}]}),document.body.appendChild(r)}function e(){if(""===o.value)o.classList.remove("underline"),o.setAttribute("style","width:100%"),o.style.width="100%";else{o.classList.add("underline");var e=document.createTextNode(o.value);["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"].forEach(function(e){r.style[e]=window.getComputedStyle(o,null).getPropertyValue(e)}),r.textContent=e.textContent;var t=0,n=document.getElementsByTagName("html")[0],s=parseInt(window.getComputedStyle(n,null).getPropertyValue("font-size"),10);t=s?Math.floor((s-14)/2*10+10):20;var a=r.offsetWidth+t+"px";o.setAttribute("style","width:"+a),o.style.width=a}}o.addEventListener("input",e),window.addEventListener("resize",e),Common.fireEvent(o,"input")}()},inputKeyDown:function(e,t){13===e.keyCode&&t.value&&(n(t.value),t.value="",Common.fireEvent(t,"input"))},sendMessage:n};function s(e,t){var n=function(e){{if(e===l.authorTypes.user)return!0;if(e===l.authorTypes.watson)return!1}return null}(t),s=e.input&&e.input.text||e.output&&e.output.text;if(null!==n&&s){var a=function(e,t){var n=t?e.input.text:e.output.text;"[object Array]"!==Object.prototype.toString.call(n)&&(n=[n]);var s=[];if(e.hasOwnProperty("output")){if(e.output.hasOwnProperty("generic")){var a=e.output.generic;a.forEach(function(e){!function(e,t){var n=t.title||"",s=t.description||"";if("image"===t.response_type){var a='<div><img src="'+t.source+'"></div>';e.push({type:t.response_type,innerhtml:n+a+s})}else if("text"===t.response_type)e.push({type:t.response_type,innerhtml:t.text});else if("pause"===t.response_type)e.push({type:t.response_type,time:t.time,typing:t.typing});else if("option"===t.response_type){var o="text";t.hasOwnProperty("preference")&&(o=t.preference);var r=function(e,t){var n="",s=0;if(null!==e)if("text"===t){for(n="<ul>",s=0;s<e.length;s++)e[s].value&&(n+='<li><div class="options-list" onclick="ConversationPanel.sendMessage(\''+e[s].value.input.text+"');\" >"+e[s].label+"</div></li>");n+="</ul>"}else if("button"===t)for(n="<br>",s=0;s<e.length;s++)if(e[s].value){var a='<div class="options-button" onclick="ConversationPanel.sendMessage(\''+e[s].value.input.text+"');\" >"+e[s].label+"</div>";n+=a}return n}(t.options,o);e.push({type:t.response_type,innerhtml:n+r})}}(s,e)})}}else if(e.hasOwnProperty("input")){var o="";n.forEach(function(e){o+=e+" "}),o.trim().replace(" ","<br>"),0!==o.length&&s.push({type:"text",innerhtml:o})}return s}(e,n),o=document.querySelector(l.selectors.chatBox),r=o.querySelectorAll((n?l.selectors.fromUser:l.selectors.fromWatson)+l.selectors.latest);r&&Common.listForEach(r,function(e){e.classList.remove("latest")}),function e(t,n,s,a,o){if(a<t.length){var r=t[a];if("pause"!==r.type){var l=(p={tagName:"div",classNames:["segments"],children:[{tagName:"div",classNames:[n?"from-user":"from-watson","latest",o?"top":"sub"],children:[{tagName:"div",classNames:["message-icon"]},{tagName:"div",classNames:["message-inner"],children:[{tagName:"p",text:r.innerhtml}]}]}]},Common.buildDomElement(p));s.appendChild(l),l.classList.add("load"),(u=document.querySelector("#scrollingChat")).scrollTop=u.scrollHeight,e(t,n,s,a+1,!1)}else{var i=document.getElementById("user-typing-field");r.typing&&(i.innerHTML="Watson Assistant Typing..."),setTimeout(function(){i.innerHTML="",e(t,n,s,a+1,o)},r.time)}}var u;var p}(a,n,o,0,!0)}}function n(e){var t,n=Api.getResponsePayload();n&&(t=n.context),Api.sendRequest(e,t)}}();ConversationPanel.init();var PayloadPanel=function(){var i={selectors:{payloadColumn:"#payload-column",payloadInitial:"#payload-initial-message",payloadRequest:"#payload-request",payloadResponse:"#payload-response"},payloadTypes:{request:"request",response:"response"}};return{init:function(){!function(){var t=Api.setRequestPayload;Api.setRequestPayload=function(e){t.call(Api,e),s(i.payloadTypes.request)};var n=Api.setResponsePayload;Api.setResponsePayload=function(e){n.call(Api,e),s(i.payloadTypes.response)}}()},togglePanel:function(e,t){var n=document.querySelector(i.selectors.payloadColumn);t.classList.contains("full")?(t.classList.remove("full"),n.classList.remove("full")):(t.classList.add("full"),n.classList.add("full"))}};function s(e){var t,n,s,a=function(e){{if(e===i.payloadTypes.request)return!0;if(e===i.payloadTypes.response)return!1}return null}(e);if(null!==a){for(var o=(n=function(e){if(null===e)return"";var t=JSON.stringify(e,null,2);return t=(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?)/g,function(e){var t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),'<span class="'+t+'">'+e+"</span>"})}((t=a)?Api.getRequestPayload():Api.getResponsePayload()),s={tagName:"div",children:[{tagName:"div",text:t?"User input":"Watson understands",classNames:["header-text"]},{tagName:"div",classNames:["code-line","responsive-columns-wrapper"],children:[{tagName:"pre",text:function(e){for(var t="",n="",s=1;s<=e;s++)t+=n,t+=s,n="\n";return t}((n.match(/\n/g)||[]).length+1),classNames:["line-numbers"]},{tagName:"pre",classNames:["payload-text","responsive-column"],html:n}]}]},Common.buildDomElement(s)),r=document.querySelector(a?i.selectors.payloadRequest:i.selectors.payloadResponse);r.lastChild;)r.removeChild(r.lastChild);r.appendChild(o);var l=document.querySelector(i.selectors.payloadInitial);(Api.getRequestPayload()||Api.getResponsePayload())&&l.classList.add("hide")}}}();